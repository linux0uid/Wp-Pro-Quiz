!function(a,b){function f(){if(!d){d=!0;for(var a=0;a<c.length;a++)c[a].fn.call(window,c[a].ctx);c=[]}}function g(){"complete"===document.readyState&&f()}a=a||"wpProQuizReady",b=b||window;var c=[],d=!1,e=!1;b[a]=function(a,b){return d?void setTimeout(function(){a(b)},1):(c.push({fn:a,ctx:b}),void("complete"===document.readyState?setTimeout(f,1):e||(document.addEventListener?(document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1)):(document.attachEvent("onreadystatechange",g),window.attachEvent("onload",f)),e=!0)))}}("wpProQuizReady",window),wpProQuizReady(function(){for(var a=window.wpProQuizInitList||[],b=0;b<a.length;b++)jQuery(a[b].id).wpProQuizFront(a[b].init)}),function(a){a.wpProQuizFront=function(b,c){function w(){var a=0,b=-1,c=0,d=!1;this.questionStart=function(c){b!=-1&&this.questionStop(),b=c,a=+new Date},this.questionStop=function(){b!=-1&&(g[b].time+=Math.round((new Date-a)/1e3),b=-1)},this.startQuiz=function(){d&&this.stopQuiz(),c=+new Date,d=!0},this.stopQuiz=function(){d&&(g.comp.quizTime+=Math.round((new Date-c)/1e3),d=!1)},this.init=function(){}}var d=a(b),e=c,f=this,g=new Object,h=new Object,i=0,j=null,k=[],l="",m=!1,n=1,o={randomAnswer:0,randomQuestion:0,disabledAnswerMark:0,checkBeforeStart:0,preview:0,cors:0,isAddAutomatic:0,quizSummeryHide:0,skipButton:0,reviewQustion:0,autoStart:0,forcingQuestionSolve:0,hideQuestionPositionOverview:0,formActivated:0,maxShowQuestion:0,sortCategories:0},p={isQuizStart:0,isLocked:0,loadLock:0,isPrerequisite:0,isUserStartLocked:0},q={check:'input[name="check"]',next:'input[name="next"]',questionList:".wpProQuiz_questionList",skip:'input[name="skip"]',singlePageLeft:'input[name="wpProQuiz_pageLeft"]',singlePageRight:'input[name="wpProQuiz_pageRight"]'},r={back:d.find('input[name="back"]'),next:d.find(q.next),quiz:d.find(".wpProQuiz_quiz"),questionList:d.find(".wpProQuiz_list"),results:d.find(".wpProQuiz_results"),quizStartPage:d.find(".wpProQuiz_text"),timelimit:d.find(".wpProQuiz_time_limit"),timelimitQuestion:d.find(".wpProQuiz_time_limit.question"),toplistShowInButton:d.find(".wpProQuiz_toplistShowInButton"),listItems:a()},s={token:"",isUser:0},t={START:0,END:1},u=function(){var a=e.timelimit,b=r.questionList.children(),c=b.eq(0),d=c.find(q.questionList).data("question_id"),g=e.json[d].catTime,h=0,i={};return i.stop=function(){a&&(window.clearInterval(h),r.timelimit.hide(),g=e.json[d].catTime)},i.nextQuestion=0,i.start=function(){if(a){var c=1e3*a,d=r.timelimit.find("span.time_left").text(f.methode.parseTime(a)),k=r.timelimit.find(".wpProQuiz_progress:not(.question)"),l=r.timelimit.find("span.question_time_left").text(f.methode.parseTime(g)),m=r.timelimit.find(".wpProQuiz_progress.question");r.timelimit.show();var n=+new Date,o=+new Date;h=window.setInterval(function(){var a=1e3*g,h=+new Date-n,p=+new Date-o,s=c-h,t=a-p;if(h>=500&&d.text(f.methode.parseTime(Math.ceil(s/1e3))),k.css("width",s/c*100+"%"),p>=500&&l.text(f.methode.parseTime(Math.ceil(t/1e3))),m.css("width",t/a*100+"%"),s<=0&&(i.stop(),f.methode.finishQuiz(!0)),t<=0&&f.methode.nextQuestion(),1==i.nextQuestion){i.nextQuestion=0;var u=j.index(),v=b.eq(u),w=v.find(q.questionList).data("question_id"),x=e.json[w];x&&(g=x.catTime),g?(o=+new Date,r.timelimitQuestion.show()):(r.timelimitQuestion.hide(),g=e.timelimit)}},16)}},i}(),v=new function(){function n(a){var d=g.eq(a),f=d.offset().top,h=b.offset().top,i=f-h;if(i-4<0||i+32>100){var k=h-g.eq(0).offset().top-(h-e.offset().top)+d.position().top;k>l&&(k=l);var m=k/j;e.attr("style","margin-top: "+-k+"px !important"),c.css({top:m})}}function p(a){var b="",c=m[a];c.review?b="#FFB800":c.solved&&(b="#6CA54C"),g.eq(a).css("background-color",b)}function q(a){a.preventDefault();var b=a.pageY-i;b<0&&(b=0),b>h&&(b=h);var d=j*b;e.attr("style","margin-top: "+-d+"px !important"),c.css({top:b})}function r(b){b.preventDefault(),a(document).unbind(".scrollEvent")}var b=[],c=[],e=[],g=[],h=0,i=0,j=0,k=0,l=0,m=[];this.init=function(){b=d.find(".wpProQuiz_reviewQuestion"),c=b.find("div"),e=b.find("ol"),g=e.children(),c.mousedown(function(b){b.preventDefault(),b.stopPropagation(),i=b.pageY-c.offset().top+k,a(document).bind("mouseup.scrollEvent",r),a(document).bind("mousemove.scrollEvent",q)}),g.click(function(b){f.methode.showQuestion(a(this).index())}),d.bind("questionSolved",function(a){m[a.values.index].solved=a.values.solved,p(a.values.index)}),d.bind("changeQuestion",function(a){g.removeClass("wpProQuiz_reviewQuestionTarget"),g.eq(a.values.index).addClass("wpProQuiz_reviewQuestionTarget"),n(a.values.index)}),d.bind("reviewQuestion",function(a){m[a.values.index].review=!m[a.values.index].review,p(a.values.index)}),b.bind("mousewheel DOMMouseScroll",function(a){a.preventDefault();var b=a.originalEvent,d=b.wheelDelta?-b.wheelDelta/120:b.detail/3,f=20*d,g=k-e.offset().top+f;g>l&&(g=l),g<0&&(g=0);var h=g/j;return e.attr("style","margin-top: "+-g+"px !important"),c.css({top:h}),!1})},this.show=function(a){if(o.reviewQustion&&b.parent().show(),d.find(".wpProQuiz_reviewDiv .wpProQuiz_button2").show(),!a){e.attr("style","margin-top: 0px !important"),c.css({top:0});var f=e.outerHeight(),g=b.height();h=g-c.height(),i=0,l=f-g,j=l/h,this.reset(),f>100&&c.show(),k=c.offset().top}},this.hide=function(){b.parent().hide()},this.toggle=function(){if(o.reviewQustion){b.parent().toggle(),g.removeClass("wpProQuiz_reviewQuestionTarget"),d.find(".wpProQuiz_reviewDiv .wpProQuiz_button2").hide(),e.attr("style","margin-top: 0px !important"),c.css({top:0});var a=e.outerHeight(),f=b.height();h=f-c.height(),i=0,l=a-f,j=l/h,a>100&&c.show(),k=c.offset().top}},this.reset=function(){for(var a=0,b=g.length;a<b;a++)m[a]={};g.removeClass("wpProQuiz_reviewQuestionTarget").css("background-color","")}},x=new w,y=function(b,c,d,e){var g=!0,h=0,i=a.isArray(c.points),j={},k={singleMulti:function(){var b=e.find(".wpProQuiz_questionInput").attr("disabled","disabled"),d=c.diffMode;e.children().each(function(e){var j=a(this),k=j.data("pos"),l=b.eq(e).is(":checked");c.correct[k]?(l?i&&(d?h=c.points[k]:h+=c.points[k]):g=!1,c.disCorrect?g=!0:f.methode.marker(j,!0)):l?(c.disCorrect?g=!0:(f.methode.marker(j,!1),g=!1),d&&(h=c.points[k])):i&&!d&&(h+=c.points[k])})},sort_answer:function(){var b=e.children();b.each(function(b,d){var e=a(this);j[b]=e.data("pos"),b==e.data("pos")?(f.methode.marker(e,!0),i&&(h+=c.points[b])):(f.methode.marker(e,!1),g=!1)}),b.children().css({"box-shadow":"0 0",cursor:"auto"}),e.sortable("destroy"),b.sort(function(b,c){return a(b).data("pos")>a(c).data("pos")?1:-1}),e.append(b)},matrix_sort_answer:function(){var b=e.children(),k=new Array;j={0:-1},b.each(function(){var b=a(this),d=b.data("pos"),e=b.find(".wpProQuiz_maxtrixSortCriterion"),l=e.children();l.length&&(j[d]=l.data("pos")),l.length&&a.inArray(String(d),String(l.data("correct")).split(","))>=0?(f.methode.marker(e,!0),i&&(h+=c.points[d])):(g=!1,f.methode.marker(e,!1)),k[d]=e}),f.methode.resetMatrix(d),d.find(".wpProQuiz_sortStringItem").each(function(){var b=k[a(this).data("pos")];void 0!=b&&b.append(this)}).css({"box-shadow":"0 0",cursor:"auto"}),d.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy")},free_answer:function(){var b=e.children(),d=b.find(".wpProQuiz_questionInput").attr("disabled","disabled").val();a.inArray(a.trim(d).toLowerCase(),c.correct)>=0?f.methode.marker(b,!0):(f.methode.marker(b,!1),g=!1)},cloze_answer:function(){e.find(".wpProQuiz_cloze").each(function(b,d){var e=a(this),j=e.children(),k=j.eq(0),l=j.eq(1),m=f.methode.cleanupCurlyQuotes(k.val());a.inArray(m,c.correct[b])>=0?(i&&(h+=c.points[b]),o.disabledAnswerMark||k.css("background-color","#B0DAB0")):(o.disabledAnswerMark||k.css("background-color","#FFBABA"),g=!1,l.show()),k.attr("disabled","disabled")})},assessment_answer:function(){g=!0;var b=e.find(".wpProQuiz_questionInput").attr("disabled","disabled"),c=0;b.filter(":checked").each(function(){c+=parseInt(a(this).val())}),h=c}};return k[b](),!i&&g&&(h=c.points),{c:g,p:h,s:j}},z=new function(){var b={isEmpty:function(b){return b=a.trim(b),!b||0===b.length}},c={TEXT:0,TEXTAREA:1,NUMBER:2,CHECKBOX:3,EMAIL:4,YES_NO:5,DATE:6,SELECT:7,RADIO:8};this.checkForm=function(){var e=!0;return d.find(".wpProQuiz_forms input, .wpProQuiz_forms textarea, .wpProQuiz_forms .wpProQuiz_formFields, .wpProQuiz_forms select").each(function(){var d=a(this),f=1==d.data("required"),g=d.data("type"),h=!0,i=a.trim(d.val());switch(g){case c.TEXT:case c.TEXTAREA:case c.SELECT:f&&(h=!b.isEmpty(i));break;case c.NUMBER:!f&&b.isEmpty(i)||(h=!b.isEmpty(i)&&!isNaN(i));break;case c.EMAIL:!f&&b.isEmpty(i)||(h=!b.isEmpty(i)&&new RegExp(/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/).test(i));break;case c.CHECKBOX:f&&(h=d.is(":checked"));break;case c.YES_NO:case c.RADIO:f&&(h=void 0!==d.find('input[type="radio"]:checked').val());break;case c.DATE:var j=0,k=0;d.find("select").each(function(){j++,k+=b.isEmpty(a(this).val())?0:1}),(f||k>0)&&(h=j==k)}h?d.siblings(".wpProQuiz_invalidate").hide():(e=!1,d.siblings(".wpProQuiz_invalidate").show())}),e},this.getFormData=function(){var b={};return d.find(".wpProQuiz_forms input, .wpProQuiz_forms textarea, .wpProQuiz_forms .wpProQuiz_formFields, .wpProQuiz_forms select").each(function(){var d=a(this),e=d.data("form_id"),f=d.data("type");switch(f){case c.TEXT:case c.TEXTAREA:case c.SELECT:case c.NUMBER:case c.EMAIL:b[e]=d.val();break;case c.CHECKBOX:b[e]=d.is(":checked")?1:0;break;case c.YES_NO:case c.RADIO:b[e]=d.find('input[type="radio"]:checked').val();break;case c.DATE:b[e]={day:d.find('select[name="wpProQuiz_field_'+e+'_day"]').val(),month:d.find('select[name="wpProQuiz_field_'+e+'_month"]').val(),year:d.find('select[name="wpProQuiz_field_'+e+'_year"]').val()}}}),b}},A=function(b){d.find(".wpProQuiz_questionList").each(function(){var c=a(this),d=c.data("question_id"),e=c.data("type"),f={};if("single"==e||"multiple"==e)c.find(".wpProQuiz_questionListItem").each(function(){f[a(this).data("pos")]=+a(this).find(".wpProQuiz_questionInput").is(":checked")});else if("free_answer"==e)f[0]=c.find(".wpProQuiz_questionInput").val();else{if("sort_answer"==e)return!0;if("matrix_sort_answer"==e)return!0;if("cloze_answer"==e){var g=0;c.find(".wpProQuiz_cloze input").each(function(){f[g++]=a(this).val()})}else"assessment_answer"==e&&(f[0]="",c.find(".wpProQuiz_questionInput:checked").each(function(){f[a(this).data("index")]=a(this).val()}))}b[d].data=f})};f.methode={parseBitOptions:function(){if(e.bo){o.randomAnswer=1&e.bo,o.randomQuestion=2&e.bo,o.disabledAnswerMark=4&e.bo,o.checkBeforeStart=8&e.bo,o.preview=16&e.bo,o.isAddAutomatic=64&e.bo,o.reviewQustion=128&e.bo,o.quizSummeryHide=256&e.bo,o.skipButton=512&e.bo,o.autoStart=1024&e.bo,o.forcingQuestionSolve=2048&e.bo,o.hideQuestionPositionOverview=4096&e.bo,o.formActivated=8192&e.bo,o.maxShowQuestion=16384&e.bo,o.sortCategories=32768&e.bo;var a=32&e.bo;a&&void 0!=jQuery.support&&void 0!=jQuery.support.cors&&0==jQuery.support.cors&&(o.cors=a)}},setClozeStyle:function(){d.find(".wpProQuiz_cloze input").each(function(){for(var b=a(this),c="",d=b.data("wordlen"),e=0;e<d;e++)c+="w";var f=a(document.createElement("span")).css("visibility","hidden").text(c).appendTo(a("body")),g=f.width();f.remove(),b.width(g+5)})},parseTime:function(a){var b=parseInt(a%60),c=parseInt(a/60%60),d=parseInt(a/3600%24);return b=(b>9?"":"0")+b,c=(c>9?"":"0")+c,d=(d>9?"":"0")+d,d+":"+c+":"+b},cleanupCurlyQuotes:function(b){return b=b.replace(/\u2018/,"'"),b=b.replace(/\u2019/,"'"),b=b.replace(/\u201C/,'"'),b=b.replace(/\u201D/,'"'),a.trim(b).toLowerCase()},resetMatrix:function(b){b.each(function(){var b=a(this),c=b.find(".wpProQuiz_sortStringList");b.find(".wpProQuiz_sortStringItem").each(function(){c.append(a(this))})})},marker:function(a,b){o.disabledAnswerMark||(b?a.addClass("wpProQuiz_answerCorrect"):a.addClass("wpProQuiz_answerIncorrect"))},startQuiz:function(b){if(p.loadLock)return void(p.isQuizStart=1);if(p.isQuizStart=0,p.isLocked)return r.quizStartPage.hide(),void d.find(".wpProQuiz_lock").show();if(p.isPrerequisite)return r.quizStartPage.hide(),void d.find(".wpProQuiz_prerequisite").show();if(p.isUserStartLocked)return r.quizStartPage.hide(),void d.find(".wpProQuiz_startOnlyRegisteredUser").show();if(o.maxShowQuestion&&!b)return r.quizStartPage.hide(),d.find(".wpProQuiz_loadQuiz").show(),void f.methode.loadQuizDataAjax(!0);if(!o.formActivated||e.formPos!=t.START||z.checkForm()){switch(f.methode.loadQuizData(),o.randomQuestion&&f.methode.random(r.questionList),o.randomAnswer&&f.methode.random(d.find(q.questionList)),o.sortCategories&&f.methode.sortCategories(),f.methode.random(d.find(".wpProQuiz_sortStringList")),f.methode.random(d.find('[data-type="sort_answer"]')),d.find(".wpProQuiz_listItem").each(function(b,c){var d=a(this);d.find(".wpProQuiz_question_page span:eq(0)").text(b+1),d.find("> h5 span").text(b+1),d.find(".wpProQuiz_questionListItem").each(function(b,c){a(this).find("> span:not(.wpProQuiz_cloze)").text(b+1+". ")})}),r.next=d.find(q.next),e.mode){case 3:d.find('input[name="checkSingle"]').show();break;case 2:d.find(q.check).show(),!o.skipButton&&o.reviewQustion&&d.find(q.skip).show();break;case 1:d.find('input[name="back"]').slice(1).show();case 0:r.next.show()}(o.hideQuestionPositionOverview||3==e.mode)&&d.find(".wpProQuiz_question_page").hide();var m=r.next.last();l=m.val(),m.val(e.lbn);var n=r.questionList.children();if(r.listItems=d.find(".wpProQuiz_list > li"),3==e.mode)f.methode.showSinglePage(0);else{j=n.eq(0).show();var s=j.find(q.questionList).data("question_id");x.questionStart(s)}x.startQuiz(),d.find(".wpProQuiz_sortable").parents("ul").sortable({update:function(b,c){var e=a(this).parents(".wpProQuiz_listItem");d.trigger({type:"questionSolved",values:{item:e,index:e.index(),solved:!0}})}}).disableSelection(),d.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",placeholder:"wpProQuiz_placehold",update:function(b,c){var e=a(this).parents(".wpProQuiz_listItem");d.trigger({type:"questionSolved",values:{item:e,index:e.index(),solved:!0}})}}).disableSelection(),k=[],u.start(),i=+new Date,g={comp:{points:0,correctQuestions:0,quizTime:0}},d.find(".wpProQuiz_questionList").each(function(){var b=a(this).data("question_id");g[b]={time:0,solved:0}}),h={},a.each(c.catPoints,function(a,b){h[a]=0}),r.quizStartPage.hide(),d.find(".wpProQuiz_loadQuiz").hide(),r.quiz.show(),v.show(),3!=e.mode&&d.trigger({type:"changeQuestion",values:{item:j,index:j.index()}})}},showSingleQuestion:function(a){var b=a?Math.ceil(a/e.qpp):1;this.showSinglePage(b)},showSinglePage:function(a){if($listItem=r.questionList.children().hide(),!e.qpp)return void $listItem.show();a=a?+a:1;var b=Math.ceil(d.find(".wpProQuiz_list > li").length/e.qpp);if(!(a>b)){var c=d.find(q.singlePageLeft).hide(),g=d.find(q.singlePageRight).hide(),h=d.find('input[name="checkSingle"]').hide();a>1&&c.val(c.data("text").replace(/%d/,a-1)).show(),a==b?h.show():g.val(g.data("text").replace(/%d/,a+1)).show(),n=a;var i=e.qpp*(a-1);$listItem.slice(i,i+e.qpp).show(),f.methode.scrollTo(r.quiz)}},nextQuestion:function(){this.showQuestionObject(j.next()),u.nextQuestion=1},prevQuestion:function(){this.showQuestionObject(j.prev())},showQuestion:function(a){var b=r.listItems.eq(a);return 3==e.mode||m?(e.qpp&&f.methode.showSingleQuestion(a+1),f.methode.scrollTo(b,1),void x.startQuiz()):void this.showQuestionObject(b)},showQuestionObject:function(a){if(!a.length&&o.forcingQuestionSolve&&o.quizSummeryHide&&o.reviewQustion)for(var b=0,c=d.find(".wpProQuiz_listItem").length;b<c;b++)if(!k[b])return alert(WpProQuizGlobal.questionsNotSolved),!1;if(j.hide(),j=a.show(),f.methode.scrollTo(r.quiz),d.trigger({type:"changeQuestion",values:{item:j,index:j.index()}}),j.length){var e=j.find(q.questionList).data("question_id");x.questionStart(e)}else f.methode.showQuizSummary()},skipQuestion:function(){d.trigger({type:"skipQuestion",values:{item:j,index:j.index()}}),f.methode.nextQuestion()},reviewQuestion:function(){d.trigger({type:"reviewQuestion",values:{item:j,index:j.index()}})},showQuizSummary:function(){if(x.questionStop(),x.stopQuiz(),o.quizSummeryHide||!o.reviewQustion)return void(o.formActivated&&e.formPos==t.END?(v.hide(),r.quiz.hide(),f.methode.scrollTo(d.find(".wpProQuiz_infopage").show())):f.methode.finishQuiz());var b=d.find(".wpProQuiz_checkPage");b.find("ol:eq(0)").empty().append(d.find(".wpProQuiz_reviewQuestion ol li").clone().removeClass("wpProQuiz_reviewQuestionTarget")).children().click(function(c){b.hide(),r.quiz.show(),v.show(!0),f.methode.showQuestion(a(this).index())});for(var c=0,g=0,h=k.length;g<h;g++)k[g]&&c++;b.find("span:eq(0)").text(c),v.hide(),r.quiz.hide(),b.show(),f.methode.scrollTo(b)},finishQuiz:function(b){x.questionStop(),x.stopQuiz(),u.stop();var c=(+new Date-i)/1e3;c=e.timelimit&&c>e.timelimit?e.timelimit:c,d.find(".wpProQuiz_quiz_time span").text(f.methode.parseTime(c)),b&&r.results.find(".wpProQuiz_time_limit_expired").show(),f.methode.checkQuestion(r.questionList.children(),!0),d.find(".wpProQuiz_correct_answer").text(g.comp.correctQuestions),g.comp.result=Math.round(g.comp.points/e.globalPoints*100*100)/100,g.comp.solved=0;var h=d.find(".wpProQuiz_points span");h.eq(0).text(g.comp.points),h.eq(1).text(e.globalPoints),h.eq(2).text(g.comp.result+"%");var j=d.find(".wpProQuiz_resultsList > li").eq(f.methode.findResultIndex(g.comp.result)),k=z.getFormData();j.find(".wpProQuiz_resultForm").each(function(){var b=a(this),c=b.data("form_id"),d=k[c];"object"==typeof d&&(d=d.day+"-"+d.month+"-"+d.year),b.text(d).show()}),j.show(),f.methode.setAverageResult(g.comp.result,!1),this.setCategoryOverview(),f.methode.sendCompletedQuiz(),o.isAddAutomatic&&s.isUser&&f.methode.addToplist(),v.hide(),d.find(".wpProQuiz_checkPage, .wpProQuiz_infopage").hide(),r.quiz.hide(),r.results.show(),f.methode.scrollTo(r.results)},setCategoryOverview:function(){g.comp.cats={},d.find(".wpProQuiz_catOverview li").each(function(){var b=a(this),c=b.data("category_id");if(void 0===e.catPoints[c])return b.hide(),!0;var d=Math.round(h[c]/e.catPoints[c]*100*100)/100;g.comp.cats[c]=d,b.find(".wpProQuiz_catPercent").text(d+"%"),b.show()})},questionSolved:function(a){k[a.values.index]=a.values.solved;var b=a.values.item.find(q.questionList),c=e.json[b.data("question_id")];g[c.id].solved=Number(a.values.fake?g[c.id].solved:a.values.solved)},sendCompletedQuiz:function(){if(!o.preview){A(g);var a=z.getFormData();f.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"completedQuiz",data:{quizId:e.quizId,results:g,forms:a}})}},findResultIndex:function(a){for(var b=e.resultsGrade,c=-1,d=999999,f=0;f<b.length;f++){var g=b[f];a>=g&&a-g<d&&(d=a-g,c=f)}return c},showQustionList:function(){m=!m,r.toplistShowInButton.hide(),r.quiz.toggle(),d.find(".wpProQuiz_QuestionButton").hide(),r.questionList.children().show(),v.toggle(),d.find(".wpProQuiz_question_page").hide()},random:function(b){b.each(function(){var b=a(this).children().get().sort(function(){return Math.round(Math.random())-.5});a(b).appendTo(b[0].parentNode)})},sortCategories:function(){var b=a(".wpProQuiz_list").children().get().sort(function(b,c){var d=a(b).find(".wpProQuiz_questionList").data("question_id"),f=a(c).find(".wpProQuiz_questionList").data("question_id");return e.json[d].catId-e.json[f].catId});a(b).appendTo(b[0].parentNode)},restartQuiz:function(){r.results.hide(),r.quizStartPage.show(),r.questionList.children().hide(),r.toplistShowInButton.hide(),v.hide(),d.find(".wpProQuiz_questionInput, .wpProQuiz_cloze input").removeAttr("disabled").removeAttr("checked").css("background-color",""),d.find('.wpProQuiz_questionListItem input[type="text"]').val(""),d.find(".wpProQuiz_answerCorrect, .wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerCorrect wpProQuiz_answerIncorrect"),d.find(".wpProQuiz_listItem").data("check",!1),d.find(".wpProQuiz_response").hide().children().hide(),f.methode.resetMatrix(d.find(".wpProQuiz_listItem")),d.find(".wpProQuiz_sortStringItem, .wpProQuiz_sortable").removeAttr("style"),d.find(".wpProQuiz_clozeCorrect, .wpProQuiz_QuestionButton, .wpProQuiz_resultsList > li").hide(),d.find('.wpProQuiz_question_page, input[name="tip"]').show(),d.find(".wpProQuiz_resultForm").text("").hide(),r.results.find(".wpProQuiz_time_limit_expired").hide(),r.next.last().val(l),m=!1},checkQuestion:function(b,c){b=void 0==b?j:b,b.each(function(){var b=a(this),f=b.find(q.questionList),i=e.json[f.data("question_id")],j=i.type;if(x.questionStop(),b.data("check"))return!0;"single"!=i.type&&"multiple"!=i.type||(j="singleMulti");var k=y(j,i,b,f);b.find(".wpProQuiz_response").show(),b.find(q.check).hide(),b.find(q.skip).hide(),b.find(q.next).show(),g[i.id].points=k.p,g[i.id].correct=Number(k.c),g[i.id].data=k.s,g.comp.points+=k.p,h[i.catId]+=k.p,k.c?(b.find(".wpProQuiz_correct").show(),g.comp.correctQuestions+=1):b.find(".wpProQuiz_incorrect").show(),b.find(".wpProQuiz_responsePoints").text(k.p),b.data("check",!0),c||d.trigger({type:"questionSolved",values:{item:b,index:b.index(),solved:!0,fake:!0}})})},showTip:function(){var b=a(this),c=b.siblings(".wpProQuiz_question").find(q.questionList).data("question_id");b.siblings(".wpProQuiz_tipp").toggle("fast"),g[c].tip=1,a(document).bind("mouseup.tipEvent",function(b){var c=d.find(".wpProQuiz_tipp"),e=d.find('input[name="tip"]');c.is(b.target)||0!=c.has(b.target).length||e.is(b.target)||(c.hide("fast"),a(document).unbind(".tipEvent"))})},ajax:function(b,c,d){d=d||"json",o.cors&&(jQuery.support.cors=!0),a.post(WpProQuizGlobal.ajaxurl,b,c,d),o.cors&&(jQuery.support.cors=!1)},checkQuizLock:function(){p.loadLock=1,f.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"quizCheckLock",data:{quizId:e.quizId}},function(a){void 0!=a.lock&&(p.isLocked=a.lock.is,a.lock.pre&&d.find('input[name="restartQuiz"]').hide()),void 0!=a.prerequisite&&(p.isPrerequisite=1,d.find(".wpProQuiz_prerequisite span").text(a.prerequisite)),void 0!=a.startUserLock&&(p.isUserStartLocked=a.startUserLock),p.loadLock=0,p.isQuizStart&&f.methode.startQuiz()})},loadQuizData:function(){f.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"loadQuizData",data:{quizId:e.quizId}},function(a){a.toplist&&f.methode.handleToplistData(a.toplist),void 0!=a.averageResult&&f.methode.setAverageResult(a.averageResult,!0)})},setAverageResult:function(a,b){var c=d.find(".wpProQuiz_resultValue:eq("+(b?0:1)+") > * ");c.eq(1).text(a+"%"),c.eq(0).css("width",240*a/100+"px")},handleToplistData:function(a){var b=d.find(".wpProQuiz_addToplist"),c=b.find(".wpProQuiz_addBox").show().children("div");if(a.canAdd)if(b.show(),b.find(".wpProQuiz_addToplistMessage").hide(),b.find(".wpProQuiz_toplistButton").show(),s.token=a.token,s.isUser=0,a.userId)c.hide(),s.isUser=1,o.isAddAutomatic&&b.hide();else{c.show();var e=c.children().eq(1);a.captcha?(e.find('input[name="wpProQuiz_captchaPrefix"]').val(a.captcha.code),e.find(".wpProQuiz_captchaImg").attr("src",a.captcha.img),e.find('input[name="wpProQuiz_captcha"]').val(""),e.show()):e.hide()}else b.hide()},scrollTo:function(b,c){var d=b.offset().top-100;(c||(window.pageYOffset||document.body.scrollTop)>d)&&a("html,body").animate({scrollTop:d},300)},addToplist:function(){if(!o.preview){var a=d.find(".wpProQuiz_addToplistMessage").text(WpProQuizGlobal.loadData).show(),b=d.find(".wpProQuiz_addBox").hide();f.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"addInToplist",data:{quizId:e.quizId,token:s.token,name:b.find('input[name="wpProQuiz_toplistName"]').val(),email:b.find('input[name="wpProQuiz_toplistEmail"]').val(),captcha:b.find('input[name="wpProQuiz_captcha"]').val(),prefix:b.find('input[name="wpProQuiz_captchaPrefix"]').val(),points:g.comp.points,totalPoints:e.globalPoints}},function(c){a.text(c.text),c.clear?(b.hide(),f.methode.updateToplist()):b.show(),c.captcha&&(b.find(".wpProQuiz_captchaImg").attr("src",c.captcha.img),b.find('input[name="wpProQuiz_captchaPrefix"]').val(c.captcha.code),b.find('input[name="wpProQuiz_captcha"]').val(""))})}},updateToplist:function(){"function"==typeof wpProQuiz_fetchToplist&&wpProQuiz_fetchToplist()},registerSolved:function(){d.find('.wpProQuiz_questionInput[type="text"]').change(function(b){var c=a(this),e=c.parents(".wpProQuiz_listItem"),f=!1;""!=c.val()&&(f=!0),d.trigger({type:"questionSolved",values:{item:e,index:e.index(),solved:f}})}),d.find('.wpProQuiz_questionList[data-type="single"] .wpProQuiz_questionInput, .wpProQuiz_questionList[data-type="assessment_answer"] .wpProQuiz_questionInput').change(function(b){var c=a(this),e=c.parents(".wpProQuiz_listItem"),f=this.checked;d.trigger({type:"questionSolved",values:{item:e,index:e.index(),solved:f}})}),d.find(".wpProQuiz_cloze input").change(function(){var b=a(this),c=b.parents(".wpProQuiz_listItem"),e=!0;c.find(".wpProQuiz_cloze input").each(function(){if(""==a(this).val())return e=!1,!1}),d.trigger({type:"questionSolved",values:{item:c,index:c.index(),solved:e}})}),d.find('.wpProQuiz_questionList[data-type="multiple"] .wpProQuiz_questionInput').change(function(b){var c=a(this),e=c.parents(".wpProQuiz_listItem"),f=0;e.find('.wpProQuiz_questionList[data-type="multiple"] .wpProQuiz_questionInput').each(function(a){this.checked&&f++}),d.trigger({type:"questionSolved",values:{item:e,index:e.index(),solved:!!f}})})},loadQuizDataAjax:function(b){f.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"quizLoadData",data:{quizId:e.quizId}},function(c){e.globalPoints=c.globalPoints,e.catPoints=c.catPoints,e.json=c.json,r.quiz.remove(),d.find(".wpProQuiz_quizAnker").after(c.content),r={back:d.find('input[name="back"]'),next:d.find(q.next),quiz:d.find(".wpProQuiz_quiz"),questionList:d.find(".wpProQuiz_list"),results:d.find(".wpProQuiz_results"),quizStartPage:d.find(".wpProQuiz_text"),timelimit:d.find(".wpProQuiz_time_limit"),timelimitQuestion:d.find(".wpProQuiz_time_limit.question"),toplistShowInButton:d.find(".wpProQuiz_toplistShowInButton"),listItems:a()},f.methode.initQuiz(),b&&f.methode.startQuiz(!0)})},initQuiz:function(){f.methode.setClozeStyle(),f.methode.registerSolved(),r.next.click(function(){return!o.forcingQuestionSolve||k[j.index()]||!o.quizSummeryHide&&o.reviewQustion?void f.methode.nextQuestion():(alert(WpProQuizGlobal.questionNotSolved),!1)}),r.back.click(function(){f.methode.prevQuestion()}),d.find(q.check).click(function(){return!o.forcingQuestionSolve||k[j.index()]||!o.quizSummeryHide&&o.reviewQustion?void f.methode.checkQuestion():(alert(WpProQuizGlobal.questionNotSolved),!1)}),d.find('input[name="checkSingle"]').click(function(){if(o.forcingQuestionSolve&&(o.quizSummeryHide||!o.reviewQustion))for(var a=0,b=d.find(".wpProQuiz_listItem").length;a<b;a++)if(!k[a])return alert(WpProQuizGlobal.questionsNotSolved),!1;f.methode.showQuizSummary()}),d.find('input[name="tip"]').click(f.methode.showTip),d.find('input[name="skip"]').click(f.methode.skipQuestion),d.find('input[name="wpProQuiz_pageLeft"]').click(function(){f.methode.showSinglePage(n-1)}),d.find('input[name="wpProQuiz_pageRight"]').click(function(){f.methode.showSinglePage(n+1)})}},f.preInit=function(){f.methode.parseBitOptions(),v.init(),d.find('input[name="startQuiz"]').click(function(){return f.methode.startQuiz(),!1}),o.checkBeforeStart&&!o.preview&&f.methode.checkQuizLock(),d.find('input[name="reShowQuestion"]').click(function(){f.methode.showQustionList()}),d.find('input[name="restartQuiz"]').click(function(){f.methode.restartQuiz()}),d.find('input[name="review"]').click(f.methode.reviewQuestion),d.find('input[name="wpProQuiz_toplistAdd"]').click(f.methode.addToplist),d.find('input[name="quizSummary"]').click(f.methode.showQuizSummary),d.find('input[name="endQuizSummary"]').click(function(){if(o.forcingQuestionSolve)for(var a=0,b=d.find(".wpProQuiz_listItem").length;a<b;a++)if(!k[a])return alert(WpProQuizGlobal.questionsNotSolved),!1;o.formActivated&&e.formPos==t.END&&!z.checkForm()||f.methode.finishQuiz()}),d.find('input[name="endInfopage"]').click(function(){z.checkForm()&&f.methode.finishQuiz()}),d.find('input[name="showToplist"]').click(function(){r.quiz.hide(),r.toplistShowInButton.toggle()}),d.bind("questionSolved",f.methode.questionSolved),o.maxShowQuestion||f.methode.initQuiz(),o.autoStart&&f.methode.startQuiz()},f.preInit()},a.fn.wpProQuizFront=function(b){return this.each(function(){void 0==a(this).data("wpProQuizFront")&&a(this).data("wpProQuizFront",new a.wpProQuizFront(this,b))})}}(jQuery);